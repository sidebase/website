{"_path":"/nuxt-session","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Quick start","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"quick-start"},"children":[{"type":"text","value":"Quick start"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Install the package:"},{"type":"element","tag":"code","props":{"code":"npm i -D @sidebase/nuxt-session\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm i -D @sidebase/nuxt-session\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Add the package to your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt.config.ts"}]},{"type":"text","value":":"},{"type":"element","tag":"code","props":{"code":"export default defineNuxtConfig({\n  modules: ['@sidebase/nuxt-session'],\n})\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"export default defineNuxtConfig({\n  modules: ['@sidebase/nuxt-session'],\n})\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Done! Each client will now have a unique session you can access on the server- and client side:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"client-side (from any "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":".vue"}]},{"type":"text","value":" file):"},{"type":"element","tag":"code","props":{"code":"const { session, refresh, update, reset } = await useSession()\n\n// Reactive session object that updates after methods calls below\nsession.value\n\n// Refresh the session\nawait refresh()\n\n// Update the session with arbitrary data\nawait update({ test: 123 })\n\n// Get a new session, all data will be lost, the session id and creation time will change\nawait reset()\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const { session, refresh, update, reset } = await useSession()\n\n// Reactive session object that updates after methods calls below\nsession.value\n\n// Refresh the session\nawait refresh()\n\n// Update the session with arbitrary data\nawait update({ test: 123 })\n\n// Get a new session, all data will be lost, the session id and creation time will change\nawait reset()\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"server-side (e.g., from "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server/api"}]},{"type":"text","value":" files):"},{"type":"element","tag":"code","props":{"code":"import { eventHandler } from 'h3'\n\n// Return all session data to the frontend\nexport default eventHandler(event => event.context.session)\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import { eventHandler } from 'h3'\n\n// Return all session data to the frontend\nexport default eventHandler(event => event.context.session)\n"}]}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" library provide many helpers to interact with the session from the client- and server-side For more documentation and examples look at the "},{"type":"element","tag":"a","props":{"href":"#documentation"},"children":[{"type":"text","value":"documentation"}]}]},{"type":"element","tag":"h1","props":{"id":"features"},"children":[{"type":"text","value":"Features"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ Persistent sessions across requests using cookies"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useSession"}]},{"type":"text","value":" composable for client side session-interaction"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ Configurable session endpoints out of the box:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"GET /api/session"}]},{"type":"text","value":": Get the current session"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"DELETE /api/session"}]},{"type":"text","value":": Delete the current session"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"POST /api/session"}]},{"type":"text","value":": Overwrite the current session data"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PATCH /api/session"}]},{"type":"text","value":": Add to the current session data"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ Storage via "},{"type":"element","tag":"a","props":{"href":"https://github.com/unjs/unstorage","rel":["nofollow"]},"children":[{"type":"text","value":"unjs/unstorage"}]},{"type":"text","value":" - use memory, redis, fs, cloudflare-kv, ... to store your session data"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ Automatic session and storage cleanup on expiry"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use the module-playground (see playground below) to play around with the module. Read the "},{"type":"element","tag":"a","props":{"href":"#documentation"},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" if you want to learn about the library without starting your local environment."}]},{"type":"element","tag":"h1","props":{"id":"playground"},"children":[{"type":"text","value":"Playground"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An example page making use of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":":\n"},{"type":"element","tag":"img","props":{"alt":"nuxt session counter example","src":"./.github/session-example.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the playground to interactively use this:"}]},{"type":"element","tag":"code","props":{"code":"> git clone https://github.com/sidebase/nuxt-session\n\n> cd nuxt-session\n\n> npm i\n\n> npm run dev:prepare\n\n> npm run dev\n\n# -> open http://localhost:3000\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"> git clone https://github.com/sidebase/nuxt-session\n\n> cd nuxt-session\n\n> npm i\n\n> npm run dev:prepare\n\n> npm run dev\n\n# -> open http://localhost:3000\n"}]}]}]},{"type":"element","tag":"h1","props":{"id":"documentation"},"children":[{"type":"text","value":"Documentation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First of all: Try out the playground if you want to test-drive this package and learn how to use it. You can also have a look "},{"type":"element","tag":"a","props":{"href":"./playground/app.vue"},"children":[{"type":"text","value":"at the playground code"}]},{"type":"text","value":" to see how to use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" in your app."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" maintains sessions: Persistent data across different requests by the same client (or: \"user\"). To maintain these sessions, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" sets a cookie with a unique client id for the currently connected client. Then after the cookie is set, the client will be uniquely identifiable by the server as long as:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the client sends this cookie on all subsequent requests,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the clients stay is shorter than the maximum session duration (default: 10 minutes, can be infinite in theory),"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the server does not loose it's data (e.g., due to a broken hard-drive)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We call this \"stay\" that lasts as long as the above criteria are met a session."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Below we describe:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#session-data"},"children":[{"type":"text","value":"Session data"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#client-side-access"},"children":[{"type":"text","value":"Client-side access"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#server-side-access"},"children":[{"type":"text","value":"Server-side access"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#storage-backends"},"children":[{"type":"text","value":"How to configure session-storage"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#configuration"},"children":[{"type":"text","value":"Configuration"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#security"},"children":[{"type":"text","value":"Security"}]}]}]},{"type":"element","tag":"h2","props":{"id":"session-data"},"children":[{"type":"text","value":"Session Data"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The session that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" maintains for you also allows you to store arbitrary data in a storage across requests for the entire duration of the session. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" makes this data available to you in different ways, depending on whether you are on the client side (e.g., "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":".vue"}]},{"type":"text","value":" components that are seen by your users) or on the server-side (e.g., inside an endpoint in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server/api/"}]},{"type":"text","value":" directory)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Reading session data is generally safe on both the client- and server-side, unless it contains anything you don't want your users to see."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Allowing alteration of session-data with arbitrary data provided by the client (e.g., your user) should be treated carefully, but can be safely done if you don't care about your users polluting sessions, have authentication and authorization or are generally not concerned about the security of your app."}]},{"type":"element","tag":"h2","props":{"id":"client-side-access"},"children":[{"type":"text","value":"Client Side Access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On the client-side you can use the session like this:"}]},{"type":"element","tag":"code","props":{"code":"const {\n  session,\n  refresh,\n  remove,\n  reset,\n  update,\n  overwrite\n} = await useSession()\n\n// The session itself, a ref that automatically updates when you use the other methods below\nsession.value\n\n// Refresh the session, e.g., after you've changed the session on the server side OR when you don't have an active session at the moment\nawait refresh()\n\n// Delete the current session without getting a new one. Note that the next request will automatically get a new session\nawait remove()\n\n// Reset the session: Under the hood this calls `remove` and then `refresh`\nawait reset()\n\n// Update the current session with arbitrary data, this data is merged into the current session with the spread-syntax, so existing data remains (unless you provide new data with the same key!)\nawait update({ \"hello\": \"session\", \"test\": 1234, \"userLikesCookies\": true })\n\n// Overwrite\nawait overwrite({ \"test\": \"This replaces all current data of the session without overwriting the current session itself\" })\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const {\n  session,\n  refresh,\n  remove,\n  reset,\n  update,\n  overwrite\n} = await useSession()\n\n// The session itself, a ref that automatically updates when you use the other methods below\nsession.value\n\n// Refresh the session, e.g., after you've changed the session on the server side OR when you don't have an active session at the moment\nawait refresh()\n\n// Delete the current session without getting a new one. Note that the next request will automatically get a new session\nawait remove()\n\n// Reset the session: Under the hood this calls `remove` and then `refresh`\nawait reset()\n\n// Update the current session with arbitrary data, this data is merged into the current session with the spread-syntax, so existing data remains (unless you provide new data with the same key!)\nawait update({ \"hello\": \"session\", \"test\": 1234, \"userLikesCookies\": true })\n\n// Overwrite\nawait overwrite({ \"test\": \"This replaces all current data of the session without overwriting the current session itself\" })\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Per default all of the above is enabled. Read on if you want to learn how to configure and disable some of the above functionalities and their respective endpoints, e.g., to secure your application."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can configure what endpoints and utilities "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" adds for client-side use using the module configuration. The API is fully enabled per default. If you want to turn off the whole "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" API you can set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session: { api: { isEnabled: false } }"}]},{"type":"text","value":" in the module config in your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt.config.ts"}]},{"type":"text","value":". If you want to keep the api enabled but allow just certain operation by the client-side, you can restrict the HTTP methods that should be allowed. E.g., "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session: { api: { methods: ['get'] } }"}]},{"type":"text","value":" would:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"add only one endpoint that allows reading the current session data (per default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"GET /api/session"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable only the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"refresh"}]},{"type":"text","value":" properties of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useSession"}]},{"type":"text","value":" composable"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After this, calling the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"reset()"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"update()"}]},{"type":"text","value":" functions from above would result in an error that the methods are not supported and the api endpoints would not be added to your nuxt-app. This way:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"you cannot accidentaly call a composable-method during development and it later does not work in production,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"if somebody tried to manually access the endpoints they would not succeed as the endpoint does not exist"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For all configuration options check out "},{"type":"element","tag":"a","props":{"href":"#configuration"},"children":[{"type":"text","value":"the configuration section"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"advanced-client-side-usage"},"children":[{"type":"text","value":"Advanced Client-Side Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The methods that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" expose are "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useFetch"}]},{"type":"text","value":" calls under the hood. For advanced use, debugging and error handling their result is directly exposed. So when you use one of them, you can destructure just like with "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/api/composables/use-fetch#usefetch","rel":["nofollow"]},"children":[{"type":"text","value":"nuxt useFetch"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"const { data, pending, error, refresh } = await update({ \"hello\": \"session\", \"test\": 1234, \"userLikesCookies\": true })\n\n// ... do something with the above reactive useFetch properties\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const { data, pending, error, refresh } = await update({ \"hello\": \"session\", \"test\": 1234, \"userLikesCookies\": true })\n\n// ... do something with the above reactive useFetch properties\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"server-side-access"},"children":[{"type":"text","value":"Server Side Access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" makes the data of the current session available to all endpoints and middlewares as part of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"event"}]},{"type":"text","value":" that is passed into the endpoints and middlewares at "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"event.context.session"}]},{"type":"text","value":". For example "},{"type":"element","tag":"a","props":{"href":"https://github.com/sidebase/nuxt-session/blob/main/playground/server/api/count.get.ts","rel":["nofollow"]},"children":[{"type":"text","value":"here's"}]},{"type":"text","value":" how you can implement a server-side request counting endpoint that stores how many requests to this endpoint where performed by that specific session:"}]},{"type":"element","tag":"code","props":{"code":"// File: `playground/server/api/count.get.ts`\nexport default eventHandler((event) => {\n  // Get the current count or set to 0 if this is the first request\n  const currentCount = event.context.session.count || 0\n\n  // Increase the count (nuxt-session will persist all changes made to `event.context.session` after the return)\n  event.context.session.count = currentCount + 1\n\n  // Return the count\n  return event.context.session.count\n})\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// File: `playground/server/api/count.get.ts`\nexport default eventHandler((event) => {\n  // Get the current count or set to 0 if this is the first request\n  const currentCount = event.context.session.count || 0\n\n  // Increase the count (nuxt-session will persist all changes made to `event.context.session` after the return)\n  event.context.session.count = currentCount + 1\n\n  // Return the count\n  return event.context.session.count\n})\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All changes made to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"event.context.session"}]},{"type":"text","value":" are automatically stored for subsequent requests by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":". So the count is set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" on the first request and then increases by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" on every subsequent request."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The server-side session also contains it's own meta-data of the form:"}]},{"type":"element","tag":"code","props":{"code":"declare interface Session {\n  id: string\n  createdAt: Date\n}\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"declare interface Session {\n  id: string\n  createdAt: Date\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In theory you can manipulate this data on the server side if you want to. If you do this, the session will likely become invalid in the process, so proceed at your own risk!"}]},{"type":"element","tag":"h2","props":{"id":"storage-backends"},"children":[{"type":"text","value":"Storage Backends"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" allows you to use different storage backends. A storage backend is something like your server memory, a redis database, the file-system of your server, ... Supporting these backend is possible by using "},{"type":"element","tag":"a","props":{"href":"https://github.com/unjs/unstorage","rel":["nofollow"]},"children":[{"type":"text","value":"unjs/unstorage"}]},{"type":"text","value":" for storage management. This library connects to the different backends it supports with a unified interface."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can configure the storage backend using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session.session.storageOptions"}]},{"type":"text","value":" configuration option of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" module. By default "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"memory"}]},{"type":"text","value":" is used to store the sessions. This has some advantages like speed and easy setup, but some disadvantages like missing persistency (if your server crashes, the sessions are gone!) and possible exploits like setting millions of sessions trying to exhaust your server-memory or saving large amounts of data into the session that your server cannot handle."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check out here what storage backends are supported and how to configure them: "},{"type":"element","tag":"a","props":{"href":"https://github.com/unjs/unstorage#drivers","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/unjs/unstorage#drivers"}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here's what the full "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" module configuration looks like:"}]},{"type":"element","tag":"code","props":{"code":"{\n  // Module is enabled\n  isEnabled: true,\n  session: {\n    // Sessions expire after 600 seconds = 10 minutes\n    expiryInSeconds: 60 * 10,\n    // Session ids are 64 characters long\n    idLength: 64,\n    // All session data is stored in a \"sub-storage\" that uses the `sessions` prefix\n    storePrefix: 'sessions',\n    // The session cookie same site policy is `lax`\n    cookieSameSite: 'lax',\n    // In-memory storage is used (these are `unjs/unstorage` options)\n    storageOptions: {}\n  },\n  api: {\n    // The API is enabled\n    isEnabled: true,\n    // `PATCH, GET, POST, DELETE /api/session` HTTP requests are possible\n    methods: ['patch', 'get', 'post', 'delete'],\n    // The sessions endpoints are mounted at `/api/session`\n    basePath: '/api/session'\n  }\n}\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"{\n  // Module is enabled\n  isEnabled: true,\n  session: {\n    // Sessions expire after 600 seconds = 10 minutes\n    expiryInSeconds: 60 * 10,\n    // Session ids are 64 characters long\n    idLength: 64,\n    // All session data is stored in a \"sub-storage\" that uses the `sessions` prefix\n    storePrefix: 'sessions',\n    // The session cookie same site policy is `lax`\n    cookieSameSite: 'lax',\n    // In-memory storage is used (these are `unjs/unstorage` options)\n    storageOptions: {}\n  },\n  api: {\n    // The API is enabled\n    isEnabled: true,\n    // `PATCH, GET, POST, DELETE /api/session` HTTP requests are possible\n    methods: ['patch', 'get', 'post', 'delete'],\n    // The sessions endpoints are mounted at `/api/session`\n    basePath: '/api/session'\n  }\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"security"},"children":[{"type":"text","value":"Security"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section mostly contains a list of possible security problems and how to mitigate (some) of them. Note that the below flaws exist with many libraries and frameworks we use in our day-to-day when building and working with APIs. E.g., your vanilla-nuxt-app is not safe of some of them like the client sending malicious data. Missing in the below list are estimates of how likely it is that one of the list-items may occur and what impact it will have on your app. This is because that heavily depends on:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"your app: Are you building a fun project? A proof of concept? The next fort-nox money management app?"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"your environment: Building a freely available app for fun? Have authentication in front of your app and trust all users that successfully authenticated? Superb! Don't trust anyone? Then please be extra-careful when using this library and when building you backend in general"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Without further ado, here's some attack cases you can consider and take action against. Neither the attack vectors, the problems or the mitigations are exhaustive:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"sending arbitrary data"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"problems: Denial-of-Service by server-ressource exhaustion (bandwidth, cpu, memory), arbitrary code execution (if you parse the data), ..."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"possible mitigations:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disable api-access to session data ("},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"api.isEnabled: false"}]},{"type":"text","value":") or restrict it to only reading ("},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"api: { methods: ['get'] }"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"parse & validate data securely on the server side before storing it into the session, e.g., using "},{"type":"element","tag":"a","props":{"href":"https://github.com/colinhacks/zod","rel":["nofollow"]},"children":[{"type":"text","value":"zod"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"we at some point implement some settings for this (e.g., max session amount, size, ...)"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"creation arbitrarily many sessions"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"problems: Denial-of-Service by server-ressource exhaustion (bandwidth, cpu, memory)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"possible mitigations:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"add authentication and possibly authorization to your app"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis"}]},{"type":"text","value":" as a storage backend and set data to expire automatically"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"guessing correct session ids"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"problems: session data can leak"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"possible mitigations:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disable reading of data on the client side by disabling the api or setting "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"api: { methods: [] }"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"increase the default sessionId length (although with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"64"}]},{"type":"text","value":" characters it already is quite long, in 2022)"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"stealing session id(s) of client(s)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"problem: session data can leak"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"possible mitigations:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"increase cookie protection, e.g., by setting "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session.cookieSameSite: 'stric'"}]},{"type":"text","value":" (default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"lax"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"use very short-lived sessions"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"don't allow session renewal"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A last reminder: This library was not written by crypto- or security-experts. So please proceed at your own risk, inspect the code if you want to and open issues / pull requests where you see room for improvement. If you want to file a security-concern privately, please send an email to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"support@sidestream.tech"}]},{"type":"text","value":" with the subject saying \"SECURITY nuxt-session\" and we'll look into your request ASAP."}]},{"type":"element","tag":"h1","props":{"id":"development"},"children":[{"type":"text","value":"Development"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Run "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run dev:prepare"}]},{"type":"text","value":" to generate type stubs."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run dev"}]},{"type":"text","value":" to start "},{"type":"element","tag":"a","props":{"href":"./playground"},"children":[{"type":"text","value":"the module playground"}]},{"type":"text","value":" in development mode."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Run "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run lint"}]},{"type":"text","value":" to run eslint"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Run "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run type"}]},{"type":"text","value":" to run typescheck via tsc"}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"quick-start"},"children":[{"type":"text","value":"Quick start"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Install the package:"},{"type":"element","tag":"code","props":{"code":"npm i -D @sidebase/nuxt-session\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm i -D @sidebase/nuxt-session\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Add the package to your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt.config.ts"}]},{"type":"text","value":":"},{"type":"element","tag":"code","props":{"code":"export default defineNuxtConfig({\n  modules: ['@sidebase/nuxt-session'],\n})\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"export default defineNuxtConfig({\n  modules: ['@sidebase/nuxt-session'],\n})\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Done! Each client will now have a unique session you can access on the server- and client side:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"client-side (from any "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":".vue"}]},{"type":"text","value":" file):"},{"type":"element","tag":"code","props":{"code":"const { session, refresh, update, reset } = await useSession()\n\n// Reactive session object that updates after methods calls below\nsession.value\n\n// Refresh the session\nawait refresh()\n\n// Update the session with arbitrary data\nawait update({ test: 123 })\n\n// Get a new session, all data will be lost, the session id and creation time will change\nawait reset()\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const { session, refresh, update, reset } = await useSession()\n\n// Reactive session object that updates after methods calls below\nsession.value\n\n// Refresh the session\nawait refresh()\n\n// Update the session with arbitrary data\nawait update({ test: 123 })\n\n// Get a new session, all data will be lost, the session id and creation time will change\nawait reset()\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"server-side (e.g., from "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server/api"}]},{"type":"text","value":" files):"},{"type":"element","tag":"code","props":{"code":"import { eventHandler } from 'h3'\n\n// Return all session data to the frontend\nexport default eventHandler(event => event.context.session)\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import { eventHandler } from 'h3'\n\n// Return all session data to the frontend\nexport default eventHandler(event => event.context.session)\n"}]}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" library provide many helpers to interact with the session from the client- and server-side For more documentation and examples look at the "},{"type":"element","tag":"a","props":{"href":"#documentation"},"children":[{"type":"text","value":"documentation"}]}]},{"type":"element","tag":"h1","props":{"id":"features"},"children":[{"type":"text","value":"Features"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ Persistent sessions across requests using cookies"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useSession"}]},{"type":"text","value":" composable for client side session-interaction"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ Configurable session endpoints out of the box:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"GET /api/session"}]},{"type":"text","value":": Get the current session"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"DELETE /api/session"}]},{"type":"text","value":": Delete the current session"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"POST /api/session"}]},{"type":"text","value":": Overwrite the current session data"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PATCH /api/session"}]},{"type":"text","value":": Add to the current session data"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ Storage via "},{"type":"element","tag":"a","props":{"href":"https://github.com/unjs/unstorage","rel":["nofollow"]},"children":[{"type":"text","value":"unjs/unstorage"}]},{"type":"text","value":" - use memory, redis, fs, cloudflare-kv, ... to store your session data"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✔️ Automatic session and storage cleanup on expiry"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use the module-playground (see playground below) to play around with the module. Read the "},{"type":"element","tag":"a","props":{"href":"#documentation"},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" if you want to learn about the library without starting your local environment."}]},{"type":"element","tag":"h1","props":{"id":"playground"},"children":[{"type":"text","value":"Playground"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An example page making use of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":":\n"},{"type":"element","tag":"img","props":{"alt":"nuxt session counter example","src":"./.github/session-example.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the playground to interactively use this:"}]},{"type":"element","tag":"code","props":{"code":"> git clone https://github.com/sidebase/nuxt-session\n\n> cd nuxt-session\n\n> npm i\n\n> npm run dev:prepare\n\n> npm run dev\n\n# -> open http://localhost:3000\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"> git clone https://github.com/sidebase/nuxt-session\n\n> cd nuxt-session\n\n> npm i\n\n> npm run dev:prepare\n\n> npm run dev\n\n# -> open http://localhost:3000\n"}]}]}]},{"type":"element","tag":"h1","props":{"id":"documentation"},"children":[{"type":"text","value":"Documentation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First of all: Try out the playground if you want to test-drive this package and learn how to use it. You can also have a look "},{"type":"element","tag":"a","props":{"href":"./playground/app.vue"},"children":[{"type":"text","value":"at the playground code"}]},{"type":"text","value":" to see how to use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" in your app."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" maintains sessions: Persistent data across different requests by the same client (or: \"user\"). To maintain these sessions, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" sets a cookie with a unique client id for the currently connected client. Then after the cookie is set, the client will be uniquely identifiable by the server as long as:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the client sends this cookie on all subsequent requests,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the clients stay is shorter than the maximum session duration (default: 10 minutes, can be infinite in theory),"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the server does not loose it's data (e.g., due to a broken hard-drive)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We call this \"stay\" that lasts as long as the above criteria are met a session."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Below we describe:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#session-data"},"children":[{"type":"text","value":"Session data"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#client-side-access"},"children":[{"type":"text","value":"Client-side access"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#server-side-access"},"children":[{"type":"text","value":"Server-side access"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#storage-backends"},"children":[{"type":"text","value":"How to configure session-storage"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#configuration"},"children":[{"type":"text","value":"Configuration"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#security"},"children":[{"type":"text","value":"Security"}]}]}]},{"type":"element","tag":"h2","props":{"id":"session-data"},"children":[{"type":"text","value":"Session Data"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The session that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" maintains for you also allows you to store arbitrary data in a storage across requests for the entire duration of the session. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" makes this data available to you in different ways, depending on whether you are on the client side (e.g., "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":".vue"}]},{"type":"text","value":" components that are seen by your users) or on the server-side (e.g., inside an endpoint in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server/api/"}]},{"type":"text","value":" directory)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Reading session data is generally safe on both the client- and server-side, unless it contains anything you don't want your users to see."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Allowing alteration of session-data with arbitrary data provided by the client (e.g., your user) should be treated carefully, but can be safely done if you don't care about your users polluting sessions, have authentication and authorization or are generally not concerned about the security of your app."}]},{"type":"element","tag":"h2","props":{"id":"client-side-access"},"children":[{"type":"text","value":"Client Side Access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On the client-side you can use the session like this:"}]},{"type":"element","tag":"code","props":{"code":"const {\n  session,\n  refresh,\n  remove,\n  reset,\n  update,\n  overwrite\n} = await useSession()\n\n// The session itself, a ref that automatically updates when you use the other methods below\nsession.value\n\n// Refresh the session, e.g., after you've changed the session on the server side OR when you don't have an active session at the moment\nawait refresh()\n\n// Delete the current session without getting a new one. Note that the next request will automatically get a new session\nawait remove()\n\n// Reset the session: Under the hood this calls `remove` and then `refresh`\nawait reset()\n\n// Update the current session with arbitrary data, this data is merged into the current session with the spread-syntax, so existing data remains (unless you provide new data with the same key!)\nawait update({ \"hello\": \"session\", \"test\": 1234, \"userLikesCookies\": true })\n\n// Overwrite\nawait overwrite({ \"test\": \"This replaces all current data of the session without overwriting the current session itself\" })\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const {\n  session,\n  refresh,\n  remove,\n  reset,\n  update,\n  overwrite\n} = await useSession()\n\n// The session itself, a ref that automatically updates when you use the other methods below\nsession.value\n\n// Refresh the session, e.g., after you've changed the session on the server side OR when you don't have an active session at the moment\nawait refresh()\n\n// Delete the current session without getting a new one. Note that the next request will automatically get a new session\nawait remove()\n\n// Reset the session: Under the hood this calls `remove` and then `refresh`\nawait reset()\n\n// Update the current session with arbitrary data, this data is merged into the current session with the spread-syntax, so existing data remains (unless you provide new data with the same key!)\nawait update({ \"hello\": \"session\", \"test\": 1234, \"userLikesCookies\": true })\n\n// Overwrite\nawait overwrite({ \"test\": \"This replaces all current data of the session without overwriting the current session itself\" })\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Per default all of the above is enabled. Read on if you want to learn how to configure and disable some of the above functionalities and their respective endpoints, e.g., to secure your application."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can configure what endpoints and utilities "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" adds for client-side use using the module configuration. The API is fully enabled per default. If you want to turn off the whole "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" API you can set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session: { api: { isEnabled: false } }"}]},{"type":"text","value":" in the module config in your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt.config.ts"}]},{"type":"text","value":". If you want to keep the api enabled but allow just certain operation by the client-side, you can restrict the HTTP methods that should be allowed. E.g., "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session: { api: { methods: ['get'] } }"}]},{"type":"text","value":" would:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"add only one endpoint that allows reading the current session data (per default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"GET /api/session"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable only the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"refresh"}]},{"type":"text","value":" properties of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useSession"}]},{"type":"text","value":" composable"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After this, calling the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"reset()"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"update()"}]},{"type":"text","value":" functions from above would result in an error that the methods are not supported and the api endpoints would not be added to your nuxt-app. This way:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"you cannot accidentaly call a composable-method during development and it later does not work in production,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"if somebody tried to manually access the endpoints they would not succeed as the endpoint does not exist"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For all configuration options check out "},{"type":"element","tag":"a","props":{"href":"#configuration"},"children":[{"type":"text","value":"the configuration section"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"advanced-client-side-usage"},"children":[{"type":"text","value":"Advanced Client-Side Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The methods that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" expose are "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useFetch"}]},{"type":"text","value":" calls under the hood. For advanced use, debugging and error handling their result is directly exposed. So when you use one of them, you can destructure just like with "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/api/composables/use-fetch#usefetch","rel":["nofollow"]},"children":[{"type":"text","value":"nuxt useFetch"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"const { data, pending, error, refresh } = await update({ \"hello\": \"session\", \"test\": 1234, \"userLikesCookies\": true })\n\n// ... do something with the above reactive useFetch properties\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const { data, pending, error, refresh } = await update({ \"hello\": \"session\", \"test\": 1234, \"userLikesCookies\": true })\n\n// ... do something with the above reactive useFetch properties\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"server-side-access"},"children":[{"type":"text","value":"Server Side Access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" makes the data of the current session available to all endpoints and middlewares as part of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"event"}]},{"type":"text","value":" that is passed into the endpoints and middlewares at "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"event.context.session"}]},{"type":"text","value":". For example "},{"type":"element","tag":"a","props":{"href":"https://github.com/sidebase/nuxt-session/blob/main/playground/server/api/count.get.ts","rel":["nofollow"]},"children":[{"type":"text","value":"here's"}]},{"type":"text","value":" how you can implement a server-side request counting endpoint that stores how many requests to this endpoint where performed by that specific session:"}]},{"type":"element","tag":"code","props":{"code":"// File: `playground/server/api/count.get.ts`\nexport default eventHandler((event) => {\n  // Get the current count or set to 0 if this is the first request\n  const currentCount = event.context.session.count || 0\n\n  // Increase the count (nuxt-session will persist all changes made to `event.context.session` after the return)\n  event.context.session.count = currentCount + 1\n\n  // Return the count\n  return event.context.session.count\n})\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// File: `playground/server/api/count.get.ts`\nexport default eventHandler((event) => {\n  // Get the current count or set to 0 if this is the first request\n  const currentCount = event.context.session.count || 0\n\n  // Increase the count (nuxt-session will persist all changes made to `event.context.session` after the return)\n  event.context.session.count = currentCount + 1\n\n  // Return the count\n  return event.context.session.count\n})\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All changes made to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"event.context.session"}]},{"type":"text","value":" are automatically stored for subsequent requests by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":". So the count is set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" on the first request and then increases by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" on every subsequent request."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The server-side session also contains it's own meta-data of the form:"}]},{"type":"element","tag":"code","props":{"code":"declare interface Session {\n  id: string\n  createdAt: Date\n}\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"declare interface Session {\n  id: string\n  createdAt: Date\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In theory you can manipulate this data on the server side if you want to. If you do this, the session will likely become invalid in the process, so proceed at your own risk!"}]},{"type":"element","tag":"h2","props":{"id":"storage-backends"},"children":[{"type":"text","value":"Storage Backends"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" allows you to use different storage backends. A storage backend is something like your server memory, a redis database, the file-system of your server, ... Supporting these backend is possible by using "},{"type":"element","tag":"a","props":{"href":"https://github.com/unjs/unstorage","rel":["nofollow"]},"children":[{"type":"text","value":"unjs/unstorage"}]},{"type":"text","value":" for storage management. This library connects to the different backends it supports with a unified interface."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can configure the storage backend using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session.session.storageOptions"}]},{"type":"text","value":" configuration option of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt-session"}]},{"type":"text","value":" module. By default "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"memory"}]},{"type":"text","value":" is used to store the sessions. This has some advantages like speed and easy setup, but some disadvantages like missing persistency (if your server crashes, the sessions are gone!) and possible exploits like setting millions of sessions trying to exhaust your server-memory or saving large amounts of data into the session that your server cannot handle."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check out here what storage backends are supported and how to configure them: "},{"type":"element","tag":"a","props":{"href":"https://github.com/unjs/unstorage#drivers","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/unjs/unstorage#drivers"}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here's what the full "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" module configuration looks like:"}]},{"type":"element","tag":"code","props":{"code":"{\n  // Module is enabled\n  isEnabled: true,\n  session: {\n    // Sessions expire after 600 seconds = 10 minutes\n    expiryInSeconds: 60 * 10,\n    // Session ids are 64 characters long\n    idLength: 64,\n    // All session data is stored in a \"sub-storage\" that uses the `sessions` prefix\n    storePrefix: 'sessions',\n    // The session cookie same site policy is `lax`\n    cookieSameSite: 'lax',\n    // In-memory storage is used (these are `unjs/unstorage` options)\n    storageOptions: {}\n  },\n  api: {\n    // The API is enabled\n    isEnabled: true,\n    // `PATCH, GET, POST, DELETE /api/session` HTTP requests are possible\n    methods: ['patch', 'get', 'post', 'delete'],\n    // The sessions endpoints are mounted at `/api/session`\n    basePath: '/api/session'\n  }\n}\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"{\n  // Module is enabled\n  isEnabled: true,\n  session: {\n    // Sessions expire after 600 seconds = 10 minutes\n    expiryInSeconds: 60 * 10,\n    // Session ids are 64 characters long\n    idLength: 64,\n    // All session data is stored in a \"sub-storage\" that uses the `sessions` prefix\n    storePrefix: 'sessions',\n    // The session cookie same site policy is `lax`\n    cookieSameSite: 'lax',\n    // In-memory storage is used (these are `unjs/unstorage` options)\n    storageOptions: {}\n  },\n  api: {\n    // The API is enabled\n    isEnabled: true,\n    // `PATCH, GET, POST, DELETE /api/session` HTTP requests are possible\n    methods: ['patch', 'get', 'post', 'delete'],\n    // The sessions endpoints are mounted at `/api/session`\n    basePath: '/api/session'\n  }\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"security"},"children":[{"type":"text","value":"Security"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section mostly contains a list of possible security problems and how to mitigate (some) of them. Note that the below flaws exist with many libraries and frameworks we use in our day-to-day when building and working with APIs. E.g., your vanilla-nuxt-app is not safe of some of them like the client sending malicious data. Missing in the below list are estimates of how likely it is that one of the list-items may occur and what impact it will have on your app. This is because that heavily depends on:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"your app: Are you building a fun project? A proof of concept? The next fort-nox money management app?"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"your environment: Building a freely available app for fun? Have authentication in front of your app and trust all users that successfully authenticated? Superb! Don't trust anyone? Then please be extra-careful when using this library and when building you backend in general"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Without further ado, here's some attack cases you can consider and take action against. Neither the attack vectors, the problems or the mitigations are exhaustive:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"sending arbitrary data"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"problems: Denial-of-Service by server-ressource exhaustion (bandwidth, cpu, memory), arbitrary code execution (if you parse the data), ..."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"possible mitigations:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disable api-access to session data ("},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"api.isEnabled: false"}]},{"type":"text","value":") or restrict it to only reading ("},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"api: { methods: ['get'] }"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"parse & validate data securely on the server side before storing it into the session, e.g., using "},{"type":"element","tag":"a","props":{"href":"https://github.com/colinhacks/zod","rel":["nofollow"]},"children":[{"type":"text","value":"zod"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"we at some point implement some settings for this (e.g., max session amount, size, ...)"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"creation arbitrarily many sessions"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"problems: Denial-of-Service by server-ressource exhaustion (bandwidth, cpu, memory)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"possible mitigations:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"add authentication and possibly authorization to your app"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis"}]},{"type":"text","value":" as a storage backend and set data to expire automatically"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"guessing correct session ids"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"problems: session data can leak"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"possible mitigations:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disable reading of data on the client side by disabling the api or setting "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"api: { methods: [] }"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"increase the default sessionId length (although with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"64"}]},{"type":"text","value":" characters it already is quite long, in 2022)"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"stealing session id(s) of client(s)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"problem: session data can leak"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"possible mitigations:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"increase cookie protection, e.g., by setting "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"session.cookieSameSite: 'stric'"}]},{"type":"text","value":" (default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"lax"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"use very short-lived sessions"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"don't allow session renewal"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A last reminder: This library was not written by crypto- or security-experts. So please proceed at your own risk, inspect the code if you want to and open issues / pull requests where you see room for improvement. If you want to file a security-concern privately, please send an email to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"support@sidestream.tech"}]},{"type":"text","value":" with the subject saying \"SECURITY nuxt-session\" and we'll look into your request ASAP."}]},{"type":"element","tag":"h1","props":{"id":"development"},"children":[{"type":"text","value":"Development"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Run "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run dev:prepare"}]},{"type":"text","value":" to generate type stubs."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run dev"}]},{"type":"text","value":" to start "},{"type":"element","tag":"a","props":{"href":"./playground"},"children":[{"type":"text","value":"the module playground"}]},{"type":"text","value":" in development mode."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Run "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run lint"}]},{"type":"text","value":" to run eslint"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Run "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run type"}]},{"type":"text","value":" to run typescheck via tsc"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"session-data","depth":2,"text":"Session Data"},{"id":"client-side-access","depth":2,"text":"Client Side Access","children":[{"id":"advanced-client-side-usage","depth":3,"text":"Advanced Client-Side Usage"}]},{"id":"server-side-access","depth":2,"text":"Server Side Access"},{"id":"storage-backends","depth":2,"text":"Storage Backends"},{"id":"configuration","depth":2,"text":"Configuration"},{"id":"security","depth":2,"text":"Security"}]}},"_type":"markdown","_id":"content:nuxt-session.md","_source":"content","_file":"nuxt-session.md","_extension":"md"}